<!-- Blocking Modal Alert - Trial Expired, Forces Action -->
<!-- Used for: Trial/subscription expired, account suspended (Day 15+) -->
<!-- Dismissible: NO - User MUST take action or upgrade -->
<!-- Behavior: Blocks entire UI, no access until action taken, countdown very urgent -->

<div class="alert-blocking-overlay alert-blocking-overlay-{{ alert.severity }}" 
     id="alert-blocking-{{ alert.id }}"
     data-alert-id="{{ alert.id }}"
     data-alert-type="blocking"
     style="display: none;"
     role="alertdialog"
     aria-modal="true"
     aria-required="true"
     onclick="event.stopPropagation()">
    
    <div class="alert-blocking-container">
        <!-- Animated danger icon -->
        <div class="alert-blocking-danger-icon">
            <svg viewBox="0 0 24 24" width="80" height="80">
                <circle cx="12" cy="12" r="11" stroke="currentColor" stroke-width="1" fill="none"/>
                <path d="M12 2 A10 10 0 1 1 12 22 A10 10 0 1 1 12 2" fill="none" stroke="currentColor" stroke-width="2" opacity="0.5"/>
                <path d="M12 8 L12 14" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
                <circle cx="12" cy="18" r="0.7" fill="currentColor"/>
            </svg>
        </div>

        <!-- Primary message -->
        <div class="alert-blocking-header">
            <h1 class="alert-blocking-title">{{ alert.title|default:"Your Trial Has Ended" }}</h1>
            <p class="alert-blocking-subtitle">{{ alert.subtitle|default:"Action Required" }}</p>
        </div>

        <!-- Main message -->
        <div class="alert-blocking-message">
            {{ alert.message }}
        </div>

        <!-- Critical countdown -->
        <div class="alert-blocking-countdown">
            <div class="countdown-status">
                {{ alert.countdown_status|default:"Upgrade Required Immediately" }}
            </div>
            {% if alert.countdown %}
                <div class="countdown-display">
                    <span class="countdown-label">{{ alert.countdown_label|default:"Days Remaining:" }}</span>
                    <span class="countdown-number" data-expire-date="{{ alert.expire_date }}">
                        {{ alert.countdown }}
                    </span>
                </div>
                <div class="countdown-message">
                    {{ alert.countdown_message|default:"After this period, your data will be permanently deleted." }}
                </div>
            {% endif %}
        </div>

        <!-- Important information box -->
        <div class="alert-blocking-info">
            <div class="info-title">What happens next:</div>
            <ul class="info-list">
                <li><strong>Limited Access:</strong> You cannot create new resources</li>
                <li><strong>Read-Only Mode:</strong> You can view your data but not edit</li>
                <li><strong>Grace Period:</strong> {{ alert.grace_period_days|default:"3" }} days to upgrade</li>
                <li><strong>Data Deletion:</strong> After {{ alert.final_days|default:"30" }} days, all data is permanently deleted</li>
            </ul>
        </div>

        <!-- Action buttons - MUST choose one -->
        <div class="alert-blocking-footer">
            {% if alert.action_url %}
                <a href="{{ alert.action_url }}" class="alert-blocking-btn alert-blocking-btn-primary">
                    <span class="btn-text">{{ alert.action_label|default:"Upgrade Now" }}</span>
                    <span class="btn-icon">â†’</span>
                </a>
            {% endif %}
            {% if alert.contact_url %}
                <a href="{{ alert.contact_url }}" class="alert-blocking-btn alert-blocking-btn-secondary">
                    {{ alert.contact_label|default:"Contact Support" }}
                </a>
            {% endif %}
        </div>

        <!-- Note about account status -->
        <div class="alert-blocking-note">
            <p class="note-text">
                <strong>Note:</strong> Your account is currently in {{ alert.status|default:"grace period" }} status.
                This is not a drill. Upgrade immediately to maintain access to your data.
            </p>
        </div>
    </div>
</div>

<style scoped>
    .alert-blocking-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, rgba(220, 53, 69, 0.8) 0%, rgba(200, 35, 51, 0.8) 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        animation: darkenIn 0.5s ease-out;
    }

    .alert-blocking-overlay::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: 
            radial-gradient(circle at 20% 50%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
            radial-gradient(circle at 80% 80%, rgba(255, 0, 0, 0.1) 0%, transparent 50%);
        pointer-events: none;
    }

    .alert-blocking-container {
        background: white;
        border-radius: 16px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        max-width: 600px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
        padding: 40px 30px;
        position: relative;
        z-index: 1;
        animation: scaleUp 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        text-align: center;
    }

    .alert-blocking-danger-icon {
        width: 80px;
        height: 80px;
        margin: 0 auto 20px;
        color: #dc3545;
        animation: pulse-danger 1.5s ease-in-out infinite;
    }

    .alert-blocking-danger-icon svg {
        width: 100%;
        height: 100%;;
    }

    .alert-blocking-header {
        margin-bottom: 20px;
    }

    .alert-blocking-title {
        margin: 0;
        font-size: 28px;
        font-weight: 800;
        color: #222;
        line-height: 1.2;
    }

    .alert-blocking-subtitle {
        margin: 8px 0 0 0;
        font-size: 14px;
        color: #999;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-weight: 600;
    }

    .alert-blocking-message {
        font-size: 16px;
        color: #555;
        line-height: 1.8;
        margin: 20px 0;
    }

    .alert-blocking-countdown {
        background: linear-gradient(135deg, #fff3cd 0%, #ffe8a1 100%);
        border: 2px solid #ffc107;
        border-radius: 12px;
        padding: 20px;
        margin: 24px 0;
    }

    .countdown-status {
        font-size: 13px;
        font-weight: 700;
        color: #856404;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 12px;
    }

    .countdown-display {
        display: flex;
        align-items: baseline;
        justify-content: center;
        gap: 12px;
        margin-bottom: 12px;
    }

    .countdown-label {
        font-size: 14px;
        font-weight: 600;
        color: #856404;
    }

    .countdown-number {
        font-size: 48px;
        font-weight: 800;
        color: #dc3545;
        font-family: 'Courier New', monospace;
    }

    .countdown-message {
        font-size: 12px;
        color: #856404;
        font-style: italic;
    }

    .alert-blocking-info {
        background-color: #f8f9fa;
        border-left: 4px solid #dc3545;
        border-radius: 8px;
        padding: 16px;
        margin: 24px 0;
        text-align: left;
    }

    .info-title {
        font-size: 14px;
        font-weight: 700;
        color: #222;
        margin-bottom: 12px;
    }

    .info-list {
        margin: 0;
        padding-left: 20px;
        list-style: none;
    }

    .info-list li {
        font-size: 14px;
        color: #555;
        margin: 8px 0;
        line-height: 1.6;
    }

    .alert-blocking-footer {
        display: flex;
        gap: 12px;
        margin: 28px 0 24px 0;
        flex-direction: column;
    }

    .alert-blocking-btn {
        padding: 16px 28px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s;
        text-decoration: none;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }

    .alert-blocking-btn-primary {
        background-color: #dc3545;
        color: white;
        box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
    }

    .alert-blocking-btn-primary:hover {
        background-color: #c82333;
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(220, 53, 69, 0.4);
    }

    .alert-blocking-btn-secondary {
        background-color: #e9ecef;
        color: #333;
    }

    .alert-blocking-btn-secondary:hover {
        background-color: #dee2e6;
        transform: translateY(-2px);
    }

    .btn-text {
        flex: 1;
    }

    .btn-icon {
        font-weight: 600;
    }

    .alert-blocking-note {
        background-color: #fff3cd;
        border: 1px solid #ffc107;
        border-radius: 8px;
        padding: 12px;
        font-size: 12px;
        color: #856404;
    }

    .note-text {
        margin: 0;
        line-height: 1.6;
    }

    @keyframes darkenIn {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }

    @keyframes scaleUp {
        from {
            transform: scale(0.9);
            opacity: 0;
        }
        to {
            transform: scale(1);
            opacity: 1;
        }
    }

    @keyframes pulse-danger {
        0%, 100% {
            opacity: 1;
        }
        50% {
            opacity: 0.6;
        }
    }

    @media (max-width: 768px) {
        .alert-blocking-container {
            width: 95%;
            padding: 30px 20px;
        }

        .alert-blocking-title {
            font-size: 24px;
        }

        .countdown-number {
            font-size: 36px;
        }

        .alert-blocking-footer {
            flex-direction: column;
        }

        .alert-blocking-btn {
            width: 100%;
        }
    }
</style>
