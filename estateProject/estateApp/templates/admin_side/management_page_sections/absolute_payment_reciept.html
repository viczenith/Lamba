{% load static %}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Receipt — Real Estate Payment</title>
  <style>
    /* CSS variables are expanded to concrete values for xhtml2pdf/reportlab compatibility */
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;color:#0f172a;background:#f4f6f8;-webkit-font-smoothing:antialiased}
    .wrap{max-width:820px;margin:24px auto;padding:12px}
    .receipt{background:#ffffff;padding:18px;border-radius:10px;border:1px solid #e6e7eb;box-shadow:0 6px 20px rgba(2,6,23,0.06)}
    .head{display:flex;justify-content:space-between;gap:12px;align-items:flex-start;margin-bottom:12px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:64px;height:64px;border-radius:8px;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#0ea5a4,#7c3aed);color:#fff;font-weight:800;font-family:ui-monospace, "Roboto Mono", monospace}
    .company h1{margin:0;font-size:18px}
    .company p{margin:3px 0;color:#6b7280;font-size:13px}
    .meta{text-align:right;min-width:220px}
    .meta .title{font-size:16px;font-weight:800}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px}
    .box{padding:12px;border-radius:8px;border:1px solid #e6e7eb;background:#fff}
    table{width:100%;border-collapse:collapse;margin-top:8px}
    th,td{padding:8px;border-bottom:1px solid #f3f4f6;font-size:14px;text-align:left}
    .right{text-align:right}
    .mono{font-family:ui-monospace, "Roboto Mono", monospace;color:#6b7280}
    .totals{display:flex;justify-content:flex-end;margin-top:12px}
    .totals .inner{width:320px;padding:12px;border-radius:8px;border:1px solid #e6e7eb;background:#fff}
    .totals .row{display:flex;justify-content:space-between;margin:6px 0;color:#6b7280}
    .totals .row.total{font-weight:800;font-size:18px;color:#0f172a;border-top:1px dashed #e6e7eb;padding-top:8px;margin-top:8px}
    .sig{display:flex;gap:12px;align-items:center;margin-top:14px}
    .sig .sig-box{width:240px;height:96px;border:1px dashed #e6e7eb;border-radius:6px;display:flex;align-items:center;justify-content:center;background:#fafafa}
    footer{margin-top:14px;text-align:center;color:#6b7280;font-size:13px}
    @media (max-width:760px){ .grid{grid-template-columns:1fr} .meta{text-align:left} .totals{justify-content:flex-start} .totals .inner{width:100%} }
    @media print{
      body{background:white}
      .wrap{margin:0}
      .receipt{box-shadow:none;border:0;border-radius:0;padding:8mm}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="receipt" role="document" aria-label="Payment receipt">
      <div class="head">
        <div class="brand">
          <div class="logo" aria-hidden="true">
            {% if company.logo_url %}
              <img src="{{ company.logo_url }}" alt="{{ company.name }} logo" style="width:100%;height:100%;object-fit:cover;border-radius:8px" />
            {% else %}
              {{ company.name|default:"FC"|slice:":2"|upper }}
            {% endif %}
          </div>
          <div class="company">
            <h1>{{ company.name }}</h1>
            <p>Official Real Estate Receipt</p>
            <p class="mono">{{ company.address }}</p>
          </div>
        </div>

        <div class="meta" aria-hidden="false">
          <div class="title">RECEIPT</div>
          <div class="mono">Receipt No: <strong id="rcpt-no">{% if receipt_number %}{{ receipt_number }}{% else %}N/A{% endif %}</strong></div>
          <div class="mono">Date: <strong id="rcpt-date">{% if payment and payment.receipt_date %}{{ payment.receipt_date|date:"d M Y" }}{% else %}{{ today|date:"d M Y" }}{% endif %}</strong></div>
          <div class="mono">Cashier: <strong id="rcpt-agent">{{ company.cashier_name }}</strong></div>
        </div>
      </div>

      <div class="grid" role="group">
        <div class="box">
          <strong>Paid By</strong>
          <p id="payer-name">{{ transaction.client.full_name }}</p>
          <p class="mono" id="payer-contact">{{ transaction.client.email }}{% if transaction.client.phone %} • {{ transaction.client.phone }}{% endif %}</p>
          <hr style="border:none;border-top:1px dashed #e6e7eb;margin:10px 0">
          <strong>Property</strong>
          <p id="property">{% if transaction.allocation.plot_number %}{{ transaction.allocation.plot_number.number }}{% else %}{{ transaction.allocation.plot_size }}{% endif %} — {{ transaction.allocation.estate.name }}</p>
          <p class="mono">Ref: <span id="prop-ref">{{ transaction.reference_code }}</span></p>
        </div>

        <div class="box">
          <strong>Payment Details</strong>
          <table>
            <tbody>
              <tr><td>Total Price</td><td class="right mono" id="total-price">{{ total_amount_display }}</td></tr>
              <tr><td>Amount Paid</td><td class="right mono" id="amount-paid">{{ payments_total_display }}</td></tr>
              <tr><td>Balance</td><td class="right mono" id="balance">{{ outstanding_display }}</td></tr>
              <tr><td>Method</td><td class="right" id="method">{% if payment %}{{ payment.get_payment_method_display }}{% else %}{{ transaction.get_payment_method_display }}{% endif %}</td></tr>
              <tr><td>Transaction Ref</td><td class="right mono" id="txn">{{ transaction.reference_code }}</td></tr>
              <tr><td>Payment Date</td><td class="right mono" id="pay-date">{% if payment %}{{ payment.payment_date|date:"d M Y" }}{% else %}{{ transaction.transaction_date|date:"d M Y" }}{% endif %}</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <div>
        <table>
          <thead>
            <tr><th>Description</th><th class="right">Amount</th></tr>
          </thead>
          <tbody>
            {% if payments and payments|length > 0 %}
              {% for p in payments %}
                <tr>
                  <td>{% if p.installment %}{{ p.get_installment_display }} Installment{% else %}Payment{% endif %} — {{ transaction.allocation.estate.name }} ({{ transaction.allocation.plot_size }})</td>
                  <td class="right mono">{{ p.display_amount }}</td>
                </tr>
              {% endfor %}
            {% else %}
                <tr>
                  <td>Full payment for {{ transaction.allocation.estate.name }} ({{ transaction.allocation.plot_size }})</td>
                  <td class="right mono">{{ total_amount_display }}</td>
                </tr>
            {% endif %}
          </tbody>
        </table>

        <div class="totals">
          <div class="inner" role="note">
            <div class="row"><div>Subtotal</div><div class="mono" id="subtotal">{{ subtotal_display }}</div></div>
            <div class="row"><div>Paid</div><div class="mono" id="paid">{{ paid_display }}</div></div>
            <div class="row total"><div>Outstanding Balance</div><div class="mono" id="outstanding">{{ outstanding_display }}</div></div>
            <div style="margin-top:8px" class="row"><div>Amount (in words)</div><div class="small mono" id="words">{{ amount_in_words }}</div></div>
          </div>
        </div>
      </div>

        <div class="sig" aria-label="signatures">
          <div>
              <div class="small"><strong id="sig-buyer">Buyer Sign Here:</strong></div>
              <div class="sig-box"></div>
          </div>
          <div style="margin-left:auto;text-align:right">
            <div class="small">Authorized by</div>
            <div style="font-weight:700" id="auth-name">{{ company.cashier_name }}</div>
            {% if company.cashier_signature_url %}
              <div style="margin-top:6px"><img src="{{ company.cashier_signature_url }}" alt="Cashier signature" style="height:48px;object-fit:contain" /></div>
            {% endif %}
            <div class="mono small" id="auth-date">{% if payment and payment.receipt_date %}{{ payment.receipt_date|date:"d M Y" }}{% else %}{{ today|date:"d M Y" }}{% endif %}</div>
          </div>
        </div>

      <footer>
        <p class="small">This receipt confirms that the above payment has been duly received for the stated property purpose. Please keep this document as proof of payment. For verification or further enquiries, call {{ company.phone }} or visit our office.</p>
      </footer>
    </div>
  </div>
</body>
</html>
